<html>
<head>
<title>PhotoFrame</title>
<script
	src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous"></script>
</head>
<body>
PhotoFrame rudimentary configuration
<hr/>
<script type="text/javascript">
function validate24(input) {
	i = parseInt(input);
	if (i > 23)
		i = 23;
	if (i < 1 || isNaN(i))
		i = 0;
	return i.toString();
}

function validateDelay(input) {
	i = parseInt(input);
	if (i < 30 || isNaN(i))
		i = 30;
	return i.toString();
}

function validateRefresh(input) {
	i = parseInt(input);
	if (i < 1 || isNaN(i))
		i = 1;
	return i.toString();
}

var fieldmap = {
	'display-off' : {'caption' : 'Turn off display at (24 hour)', 'validate' : validate24},
	'display-on'  : {'caption' : 'Turn on display at (24 hour)', 'validate' : validate24},
	'interval'    : {'caption' : 'Seconds to show each image', 'validate' : validateDelay},
	'refresh-content' : {'caption' : 'Hours before reloading server image list', 'validate' : validateRefresh},
};

$(document).ready(function(){
	$.ajax({
		url:"/setting"
	}).done(function(data){
		for (key in data) {
			if (key == 'keywords')
				continue;
			value = data[key];
			validate = null;
			name = key;
			if (key in fieldmap) {
				name = fieldmap[key]['caption'];
				if ('validate' in fieldmap[key])
					validate = fieldmap[key]['validate'];
			}
			$('#fields').append(name + '<br><input ' + (validate?'data-validate="true"':'') + ' type="text" name="' + key + '" value="' + value + '"><br>');
		}
		$('#fields').append('Photo keywords:<br>');
		$('#fields').append('<input type="text" id="keyword"><input type="button" id="add" value="Add keywords"><br>');

		$('#add').click(function(){
			$.ajax({
				url:"/keywords/add",
				type:"POST",
				data: JSON.stringify({ keywords: $('#keyword').val() }),
				contentType: "application/json; charset=utf-8",
				dataType: "json"
			}).done(function(data){
				console.log(data);
			});
		});

		$.ajax({
			url:"/islinked"
		}).done(function(data){
			$("input[type='text']").change(function() {
				console.log("Change detected: " + $(this).val());
				if ($(this).data('validate')) {
					console.log('Needs validating');
					$(this).val(fieldmap[this.name]['validate']($(this).val()));
				}
			});

			if (data["linked"])
				 $('#fields').append('Frame is linked to Google Photos, <a href="/link">reconnect</a>');
			else
				 $('#fields').append('<a href="/link">Connect frame to Google Photos</a>');
			$("#reset").click(function() {
				if (confirm("Are you sure? Link to photos will also be reset")) {
					$.ajax({
						url:"/reset"
					}).done(function(){
						location.reload();
					});
				}
			});
		});
	});
});
</script>
<p id="fields"></p>
<input type="button" id="reset" value="Reset all">
</body>
</html>
